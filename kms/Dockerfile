FROM xutongle/dependent:latest

ENV DEBIAN_FRONTEND noninteractive

MAINTAINER XUTONGLE <xutongle@gmail.com>

ENV PHP_INSTALL_DIR=/usr/local

RUN apt-get update && \
  apt-get install -y wget git vim libmcrypt-dev libpng12-dev libxslt-dev libtidy-dev bzip2 libbz2-dev \
  libssl-dev expect libicu-dev libmemcached11 libmemcached-dev --no-install-recommends && \
  rm -rf /var/lib/apt/lists/*

WORKDIR /tmp

RUN wget -c --no-check-certificate https://xutl.oss-cn-hangzhou.aliyuncs.com/docker-asset/vlmcs/vlmcsdmulti-x64-musl-static

##<autogenerated>##

# install nginx
RUN apt-key adv --keyserver keyserver.ubuntu.com --recv-keys ABF5BD827BD9BF62 && \
    echo "deb http://www.nginx.org/packages/debian/ jessie nginx" > /etc/apt/sources.list.d/nginx.list && \
    apt-get update && \
    apt-get install -y nginx && \
    apt-get clean && \
    echo -n > /var/lib/apt/extended_states

RUN usermod -u 1000 www-data

###</autogenerated>##

ADD php.ini /usr/local/etc/php/php.ini
ADD php-fpm.conf /usr/local/etc/
ADD nginx.conf /etc/nginx/nginx.conf
ADD supervisord-*.conf /etc/supervisor/conf.d/

# Define the default command.
CMD ["/bin/bash"]
#CMD ["/run.sh"]